<%- include('header.ejs') %>
<div class="bodyContainer">
    <div class="row filtersTab">
        <button class="accordion">COLOR</button>
        <div class="content">
            <% _.each(filters.swatches, function(link, index) { %>
                <img id="swatch-<%= index %>" class="colorSwatch" src="/images/<%= link %>"></img>
            <% }) %>
        </div>
        <button class="accordion">SIZE</button>
        <div class="content">
            <% _.each(filters.sizes, function(sizes) { %>
                <button class="filterSizes"><%= sizes %></button>
            <% }) %>   
        </div>
        <button id="removeFiltersButton" class="removeFiltersButton" style="background-color: #ff0000; color: #ffffff; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">Remove Filters</button>
    </div>
    <ol class="row productCardContainer">
        <% _.each(items, function(product) { %>   
            <a href="/product/<%=product.id%>">
            <li class="productCard productItem">
                <% let bool = true; %>
                <% _.each(product.image_groups, function(image_group) { %>
                    <% if (image_group.view_type === "medium" && image_group.images[0].link && bool) { %>
                        <img class="image" src="/images/<%= image_group.images[0].link %>"></img>
                        <% bool = false; %>
                        <% if (product.c_isSale === true) { %>
                            <div class="ribbon">
                                <span>SALE</span>
                            </div>
                        <% } %>
                    <% } %>
                <% }); %>

                <div class="content">
                    <div class="color_variations">
                        <% _.each(product.image_groups, function(image_group) { %>
                            <% if (image_group.view_type === "swatch") { %>
                                <% _.each(image_group.images, function(link) { %>
                                    <% if (!!link.link) { %>
                                        <img src="/images/<%= link.link %>"></img>
                                    <% } %>
                                <% }) %>
                            <% } %>
                        <% }); %> 
                    </div>
                    <h3 class="name"><%= product.name %></h3>
                </div>
                <hr style="margin:0">
                <div class="price"><%= product.price %> <%= product.currency %></div>
            </li>
        </a>
    <% }); %>
</ol>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Get all the color swatches
  const colorSwatches = document.querySelectorAll(".colorSwatch");

  // Add click event listener to each color swatch
  colorSwatches.forEach(function(swatch) {
    swatch.addEventListener("click", function() {
      // Remove 'selected' class from all color swatches
      colorSwatches.forEach(function(swatch) {
        swatch.classList.remove("selected");
      });

      // Add 'selected' class to the clicked color swatch
      this.classList.add("selected");

      // Get the selected color from the src attribute of the clicked swatch
      const selectedColor = this.getAttribute("src").split("/").pop().split("_")[0];

      // Loop through each product item
      const productItems = document.querySelectorAll(".productItem");
      productItems.forEach(function(item) {
        // Get all the color variations for the current product item
        const colorVariations = item.querySelectorAll(".color_variations img");

        // Check if any color variation matches the selected color
        let hasMatch = false;
        colorVariations.forEach(function(variation) {
          const variationColor = variation.getAttribute("src");
          const variationColorCode = variationColor.split("/").pop().split("_")[0];
          console.log("selected color:", selectedColor);
          console.log("variation color:", variationColorCode);
          if (variationColorCode === selectedColor) {
            hasMatch = true;
          }
        });

        // Toggle the visibility of product item based on the color match
        if (hasMatch) {
          item.style.removeProperty("display");
        } else {
          item.style.display = "none";
        }
        console.log("product item visibility:", item.style.display);
      });
    });
  });

  // Add click event listener to the "Remove Filters" button
  const removeFiltersButton = document.getElementById("removeFiltersButton");
  removeFiltersButton.addEventListener("click", function() {
    // Remove 'selected' class from all color swatches
    colorSwatches.forEach(function(swatch) {
      swatch.classList.remove("selected");
    });

    // Show all product items
    const productItems = document.querySelectorAll(".productItem");
    productItems.forEach(function(item) {
      item.style.removeProperty("display");
    });
  });
});
</script>
</div>
<%- include('footer.ejs') %>